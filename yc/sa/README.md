# Terraform Yandex Service Account module

> Project moved to https://gitlab.com/tf-org-ru/terraform-yandex-service-account/
>
> Next versions of module will be published as
*gitlab.com/tf-org-ru/service-account/yandex* on Gitlab module registry.

A terraform module to create a service account on Yandex Cloud. Module will manage

* service account,
* bindings to roles in the folder,
* static access keys of account,
* service account keys of account. 

## Example usage

```terraform
module "storage_admin" {
  source  = "gitlab.com/tf-org-ru/service-account/yandex"
  version = "~> 3.0" 

  name              = "storage-admin"
  roles             = ["storage.admin"]
  static_access_keys = {"default" = {}}
}

module "backup_sa" {
  source  = "gitlab.com/tf-org-ru/service-account/yandex"
  version = "~> 3.0"

  name                = "backup"
  service_account_key = {"default" = {}}
}

resource "yandex_storage_bucket" "default" {
  access_key = module.storage_admin.static_access_keys["default"]["access_key"]
  secret_key = module.storage_admin.static_access_keys["default"]["secret_key"]

  bucket = "backups"

  grant {
    type        = "CanonicalUser"
    id          = module.backup_sa.id
    permissions = ["READ", "WRITE"]
  }
}

output "backup_sa_key" {
  value = module.backup_sa.service_account_keys["default"]["json_key"]
}
```
<!-- BEGIN_TF_DOCS -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (~> 1.3)

- <a name="requirement_yandex"></a> [yandex](#requirement\_yandex) (~> 0.129)

## Required Inputs

The following input variables are required:

### <a name="input_name"></a> [name](#input\_name)

Description:   Name of the service account.

  Name can contain only small letters, digits and dashes, must be started with  
  the letter and must not be ended with dash.

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_description"></a> [description](#input\_description)

Description: Description of the service account.

Type: `string`

Default: `"Managed by terraform"`

### <a name="input_folder_id"></a> [folder\_id](#input\_folder\_id)

Description: ID of the folder that the service account will be created in. Defaults to the provider folder configuration.

Type: `string`

Default: `null`

### <a name="input_roles"></a> [roles](#input\_roles)

Description: Roles of the service account in the folder.

Type: `set(string)`

Default: `[]`

### <a name="input_service_account_keys"></a> [service\_account\_keys](#input\_service\_account\_keys)

Description:   [Authorized keys](https://cloud.yandex.com/docs/iam/concepts/authorization/key) of account.

  Map from the symbolic name to properties of the keys.

Type:

```hcl
map(object({
    description   = optional(string, "Managed by Terraform")
    format        = optional(string)
    key_algorithm = optional(string)
    pgp_key       = optional(string)

    output_to_lockbox = optional(object({
      secret_id             = string
      entry_for_private_key = string
    }))
  }))
```

Default: `{}`

### <a name="input_static_access_keys"></a> [static\_access\_keys](#input\_static\_access\_keys)

Description:   [Static access keys](https://cloud.yandex.com/docs/iam/operations/sa/create-access-key) of account.

  Map from the symbolic name to properties of the keys.

Type:

```hcl
map(object({
    description = optional(string, "Managed by Terraform")
    pgp_key     = optional(string)

    output_to_lockbox = optional(object({
      secret_id            = string
      entry_for_access_key = string
      entry_for_secret_key = string
    }))
  }))
```

Default: `{}`

## Outputs

The following outputs are exported:

### <a name="output_id"></a> [id](#output\_id)

Description: ID of the service account.

### <a name="output_name"></a> [name](#output\_name)

Description: Name of the service account.

### <a name="output_service_account_keys"></a> [service\_account\_keys](#output\_service\_account\_keys)

Description:   Properties of the service account keys, including  
  JSON representation of service account key  
  as generated by `yc iam key create --output key.json`.

### <a name="output_static_access_keys"></a> [static\_access\_keys](#output\_static\_access\_keys)

Description: Properties of the static access keys.
<!-- END_TF_DOCS -->